/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2017 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void *init_proc();
int sub_8049030();
// char *strstr(const char *haystack, const char *needle);
// int puts(const char *s);
// void exit(int status);
// size_t strlen(const char *s);
// int fprintf(FILE *stream, const char *format, ...);
void sub_80490D7();
void sub_80490F0();
// int (__cdecl **__usercall sub_8049100@<eax>(int a1@<ebp>))(_DWORD);
int nullsub_1(void); // weak
// int (__cdecl **__usercall sub_8049180@<eax>(int a1@<ebp>))(_DWORD);
int sub_80491B0();
__int64 __cdecl sub_80491B6(_BYTE *a1);
bool __cdecl sub_804928C(char *s);
int __cdecl main(int a1, char **a2);
void sub_8049415();
void term_proc();
// int __cdecl ITM_deregisterTMCloneTable(_DWORD); weak
// int __cdecl ITM_registerTMCloneTable(_DWORD, _DWORD); weak

//-------------------------------------------------------------------------
// Data declarations

int (*dword_804C008)(void) = NULL; // weak
_UNKNOWN unk_804C02C; // weak
FILE *stderr; // idb
char byte_804C034; // weak
// extern _UNKNOWN _gmon_start__; weak


//----- (08049000) --------------------------------------------------------
void *init_proc()
{
  void *result; // eax

  __asm { endbr32 }
  result = &_gmon_start__;
  if ( &_gmon_start__ )
    result = (void *)((int (*)(void))_gmon_start__)();
  return result;
}

//----- (08049030) --------------------------------------------------------
int sub_8049030()
{
  return dword_804C008();
}
// 804C008: using guessed type int (*dword_804C008)(void);

//----- (080490A0) --------------------------------------------------------
#error "80490A7: positive sp value has been found (funcsize=3)"

//----- (080490D7) --------------------------------------------------------
void sub_80490D7()
{
  ;
}

//----- (080490F0) --------------------------------------------------------
void sub_80490F0()
{
  ;
}

//----- (08049100) --------------------------------------------------------
int (__cdecl **__usercall sub_8049100@<eax>(int a1@<ebp>))(_DWORD)
{
  int (__cdecl **result)(_DWORD); // eax
  int v2; // [esp-4h] [ebp-4h]

  result = (int (__cdecl **)(_DWORD))&unk_804C02C;
  if ( &unk_804C02C != &unk_804C02C )
  {
    result = &ITM_deregisterTMCloneTable;
    if ( &ITM_deregisterTMCloneTable )
    {
      v2 = a1;
      result = (int (__cdecl **)(_DWORD))ITM_deregisterTMCloneTable(&unk_804C02C);
    }
  }
  return result;
}
// 8049100: could not find valid save-restore pair for ebp
// 804C050: using guessed type int __cdecl ITM_deregisterTMCloneTable(_DWORD);

//----- (08049180) --------------------------------------------------------
int (__cdecl **__usercall sub_8049180@<eax>(int a1@<ebp>))(_DWORD)
{
  int (__cdecl **result)(_DWORD); // eax
  int v2; // [esp-4h] [ebp-4h]

  __asm { endbr32 }
  if ( !byte_804C034 )
  {
    v2 = a1;
    result = sub_8049100((int)&v2);
    byte_804C034 = 1;
  }
  return result;
}
// 8049180: could not find valid save-restore pair for ebp
// 804C034: using guessed type char byte_804C034;

//----- (080491B0) --------------------------------------------------------
int sub_80491B0()
{
  __asm { endbr32 }
  return nullsub_1();
}
// 80491B0: could not find valid save-restore pair for ebp
// 8049178: using guessed type int nullsub_1(void);
// 804C058: using guessed type int __cdecl ITM_registerTMCloneTable(_DWORD, _DWORD);

//----- (080491B6) --------------------------------------------------------
__int64 __cdecl sub_80491B6(_BYTE *a1)
{
  _BYTE *i; // [esp+4h] [ebp-Ch]
  __int64 v3; // [esp+8h] [ebp-8h]

  v3 = 0LL;
  for ( i = a1; i < a1 + 8; ++i )
  {
    v3 *= 62LL;
    if ( *i > 64 && *i <= 90 )
      v3 += (char)*i - 65;
    if ( *i > 96 && *i <= 122 )
      v3 += (char)*i - 71;
    if ( *i > 47 && *i <= 57 )
      v3 += (char)*i + 4;
  }
  return v3;
}

//----- (0804928C) --------------------------------------------------------
bool __cdecl sub_804928C(char *s)
{
  if ( strlen(s) != 15 )
    return 0;
  if ( s != strstr(s, "nactf{") )
    return 0;
  if ( s[14] == 125 )
    return sub_80491B6(s + 6) == 21380291284888LL;
  return 0;
}

//----- (08049311) --------------------------------------------------------
int __cdecl main(int a1, char **a2)
{
  if ( a1 <= 1 )
  {
    fprintf(stderr, "Usage: %s [key]", *a2);
    exit(1);
  }
  if ( sub_804928C(a2[1]) )
    puts("Key valid!\n");
  else
    puts("Invalid key.\n");
  return 0;
}

//----- (08049415) --------------------------------------------------------
void sub_8049415()
{
  ;
}

//----- (0804941C) --------------------------------------------------------
void term_proc()
{
  __asm { endbr32 }
}

#error "There were 1 decompilation failure(s) on 13 function(s)"
